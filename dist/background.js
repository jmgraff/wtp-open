!function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=650)}({650:function(e,t,n){"use strict";n.r(t);class r{constructor(){this.authToken=void 0}static async getAuthToken(){return console.log("Getting auth token"),new Promise((e,t)=>{chrome.identity.getAuthToken({interactive:!0},t=>{e(t)})})}async auth(){this.authToken=await r.getAuthToken()}async send(e,t,n){await this.auth();let r="";r+="To: "+e+"\r\n",r+="Subject: "+t+"\r\n",r+="Content-Type: text/plain; charset=utf-8\r\n",r+="MIME-Version: 1.0\r\n",r+="\r\n",r+=n;let i={raw:btoa(r).replace(/\+/g,"-").replace(/\//g,"_")};return new Promise((e,t)=>{let n=new XMLHttpRequest;n.onreadystatechange=()=>{4===n.readyState&&200===n.status&&e()},n.open("POST","https://www.googleapis.com/gmail/v1/users/me/messages/send",!0),n.setRequestHeader("Authorization","Bearer "+this.authToken),n.setRequestHeader("Content-Type","application/json"),n.send(JSON.stringify(i))})}}var i,s,a,o,c;i=new class{constructor(e="check.js"){this.reference=void 0,this.scriptName=e}async createTab(){let e=this;return new Promise(function(t,n){chrome.tabs.create({index:0,active:!1,pinned:!0},function(n){chrome.tabs.onRemoved.addListener(e.tabRemovedCallback.bind(e)),e.reference=n,t()})})}tabRemovedCallback(e){null!=this.reference&&this.reference.id==e&&(this.reference=void 0)}close(){null!=this.reference&&chrome.tabs.remove(this.reference.id)}async init(){null==this.reference&&await this.createTab()}async executeScript(){let e=this.reference.id;return new Promise(function(t,n){chrome.tabs.executeScript(e,{file:this.scriptName,runAt:"document_end"},function(){t()})}.bind(this))}async navigate(e){let t=this.reference.id;return new Promise(function(n,r){chrome.tabs.update(t,{url:e}),chrome.tabs.onUpdated.addListener(function e(r,i){r==t&&"complete"==i.status&&(chrome.tabs.onUpdated.removeListener(e),n())})})}async check(e,t){await this.init(),await this.navigate(e),await this.executeScript();let n=this.reference.id;return new Promise(function(e,r){chrome.tabs.sendMessage(n,{type:"check",selector:t},function(t){e(t.value)})})}},a=new r,o=[],c=function(e){return chrome.notifications.create({iconUrl:"images/Logo.png",type:"basic",title:e.settings.nickname,message:`Change Found!\n${e.url}`})},s=function(e){var t;return t=`Change detected!\n\n${e.settings.nickname}\n${e.url}\n\n------------------------------------------\nCurrent Value (${new Date(e.history[0].timestamp).toLocaleString()})\n------------------------------------------\n${e.history[0].value}\n\n\n------------------------------------------\nLast Value (${new Date(e.history[1].timestamp).toLocaleString()})\n------------------------------------------\n${e.history[1].value}\n\n\nLove,\nWebsite Tracker Pro :)`,a.send(e.settings.emailNotificationRecipients,`Website Tracker Pro: ${e.settings.nickname}`,t)},setInterval(async function(){var e,t,n,r,a,u;for(a=Date.now(),u=[],t=0,n=o.length;t<n;t++)(e=o[t]).settings.paused||(a>=e.nextCheck?(e.nextCheck=a+e.settings.interval*e.settings.timeUnit,console.log(`${new Date(a).toLocaleString()}: Checking ${e.settings.nickname}`),(r=await i.check(e.url,e.settings.selector))!==e.history[0].value?(console.log(`Changed! Was: ${e.history[0].value}, Now: ${r}`),e.history.unshift({timestamp:a,value:r}),e.settings.desktopNotifications&&c(e),e.settings.emailNotifications?u.push(s(e)):u.push(void 0)):u.push(void 0)):u.push(void 0));return u},1e4),chrome.runtime.onMessage.addListener(async function(e,t,n){var r,i,s,c;switch(r=function(){return new Promise(function(e,t){return chrome.tabs.query({active:!0,windowType:"normal",currentWindow:!0},function(t){return e(t[0].id)})})},c=function(e){var t;return function(){var n,r,i;for(i=[],n=0,r=o.length;n<r;n++)(t=o[n]).id===e&&i.push(t);return i}()[0]},i=function(e){var t;return function(){var n,r,i;for(i=[],n=0,r=o.length;n<r;n++)(t=o[n]).settings.selector===e.settings.selector&&t.url===e.url&&i.push(t);return i}().length>0},e.type){case"getItems":n({items:o});break;case"deleteItem":o=o.filter(function(t){return t.id!==e.id}),n();break;case"saveItem":i(e.item)||o.unshift(e.item),n();break;case"saveItemSettings":c(e.item.id).settings=e.item.settings,!0===e.item.settings.emailNotifications&&a.auth(),n();break;case"setItemPaused":c(e.id).settings.paused=e.paused,chrome.runtime.sendMessage({type:"setItems",items:o});break;case"inject":return s=await r(),chrome.tabs.sendMessage(s,{type:"isInjected"},function(e){return e?(console.log("Content script is already injected"),chrome.tabs.sendMessage(s,{type:"startPicking"})):(chrome.runtime.lastError.message,console.log("Injecting content script"),chrome.tabs.executeScript({file:"content.js",runAt:"document_end"},function(){return n()}))}),!0}})}});